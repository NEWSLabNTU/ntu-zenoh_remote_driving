# direnv configuration for Zenoh Remote Driving
# Run `direnv allow` to enable

AUTOSDV_LINK="${PWD}/script/AutoSDV"

# Check if AutoSDV symlink exists and is valid
if [[ ! -L "${AUTOSDV_LINK}" ]] || [[ ! -d "${AUTOSDV_LINK}" ]]; then
    echo "ERROR: script/AutoSDV symlink is missing or invalid."
    echo "Please create it with:"
    echo "  ln -sfn /path/to/AutoSDV script/AutoSDV"
    return 1
fi

# Source AutoSDV (chains to /opt/ros/humble/setup.bash)
source "${AUTOSDV_LINK}/install/setup.bash"

# Watch and source project workspace if it exists
watch_file "${PWD}/install/setup.bash"
if [[ -f "${PWD}/install/setup.bash" ]]; then
    source "${PWD}/install/setup.bash"
fi

# ============================================================================
# rmw_zenoh Configuration
# ============================================================================
# Use Zenoh as the ROS 2 middleware instead of DDS
export RMW_IMPLEMENTATION=rmw_zenoh_cpp

# Zenoh router configuration (used by: ros2 run rmw_zenoh_cpp rmw_zenohd)
export ZENOH_ROUTER_CONFIG_URI="${PWD}/config/zenoh/router.json5"

# Default session configuration for local nodes (operator station)
# Vehicle-side nodes should override this with session_vehicle.json5
export ZENOH_SESSION_CONFIG_URI="${PWD}/config/zenoh/session_local.json5"

# Skip router check for client-mode sessions (vehicle side)
# Set to -1 to skip, 0 to wait indefinitely, >0 for number of attempts
# export ZENOH_ROUTER_CHECK_ATTEMPTS=1
